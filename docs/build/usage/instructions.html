
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Instructions &#8212; peakipy 0.1.16 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Quickstart instructions" href="quickstart.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="instructions">
<h1>Instructions<a class="headerlink" href="#instructions" title="Permalink to this headline">¶</a></h1>
<p>First you need a peak list in either Sparky, Analysis2 or NMRPipe format.</p>
<div class="section" id="analysis2-peak-list">
<h2>Analysis2 peak list<a class="headerlink" href="#analysis2-peak-list" title="Permalink to this headline">¶</a></h2>
<p>Example of tab delimited peak list exported directly from Analysis2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span>  <span class="c1">#       Position F1     Position F2     Sampled None    Assign F1       Assign F2       Assign F3       Height  Volume  Line Width F1 (Hz)  Line Width F2 (Hz)      Line Width F3 (Hz)      Merit   Details Fit Method      Vol. Method</span>
<span class="mi">1</span>       <span class="mi">1</span>       <span class="mf">9.33585</span> <span class="mf">129.67323</span>       <span class="mf">2.00000</span>  <span class="p">{</span><span class="mi">23</span><span class="p">}</span><span class="n">H</span><span class="p">[</span><span class="mi">45</span><span class="p">]</span>       <span class="p">{</span><span class="mi">23</span><span class="p">}</span><span class="n">N</span><span class="p">[</span><span class="mi">46</span><span class="p">]</span>       <span class="mf">2.0</span>    <span class="mf">3.91116e+07</span>     <span class="mf">2.14891e+08</span>     <span class="mf">15.34578</span>        <span class="mf">19.24590</span>    <span class="kc">None</span>    <span class="mf">1.00000</span> <span class="kc">None</span>    <span class="n">parabolic</span>       <span class="n">box</span> <span class="nb">sum</span>
<span class="mi">2</span>       <span class="mi">2</span>       <span class="mf">10.38068</span>        <span class="mf">129.32604</span>       <span class="mf">2.00000</span>  <span class="p">{</span><span class="mi">9</span><span class="p">}</span><span class="n">H</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>        <span class="p">{</span><span class="mi">9</span><span class="p">}</span><span class="n">N</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span>        <span class="mf">2.0</span>    <span class="mf">6.61262e+07</span>     <span class="mf">3.58137e+08</span>     <span class="mf">15.20785</span>        <span class="mf">19.76284</span>        <span class="kc">None</span>    <span class="mf">1.00000</span> <span class="kc">None</span>    <span class="n">parabolic</span>       <span class="n">box</span> <span class="nb">sum</span>
</pre></div>
</div>
<p>Note that the Position F1 and Position F2 are actually the wrong way round (i.e. F1=x and F2=y). I think this happens by default with Analysis2, however, you can chastise me for being an idiot if I’m wrong.
<code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">read</span></code> will flip them around, so beware.
If you have “correctly” labelled columns then you can use <code class="docutils literal notranslate"><span class="pre">--posF1=&lt;column_name&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">--posF2=&lt;column_name&gt;</span></code> to define which column names map to <code class="docutils literal notranslate"><span class="pre">Y_PPM</span></code> and <code class="docutils literal notranslate"><span class="pre">X_PPM</span></code>, respectively.</p>
</div>
<div class="section" id="sparky-peak-list">
<h2>Sparky peak list<a class="headerlink" href="#sparky-peak-list" title="Permalink to this headline">¶</a></h2>
<p>Minimum:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Assignment</span>  <span class="n">w1</span>  <span class="n">w2</span>
<span class="n">PeakOne</span> <span class="mi">118</span> <span class="mf">7.5</span>
<span class="n">PeakTwo</span> <span class="mi">119</span> <span class="mf">7.4</span>
<span class="n">etc</span><span class="o">...</span>
</pre></div>
</div>
<p>Also accepted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Assignment</span>         <span class="n">w1</span>         <span class="n">w2</span>        <span class="n">Volume</span>   <span class="n">Data</span> <span class="n">Height</span>   <span class="n">lw1</span> <span class="p">(</span><span class="n">hz</span><span class="p">)</span>   <span class="n">lw2</span> <span class="p">(</span><span class="n">hz</span><span class="p">)</span>
    <span class="n">ALA8N</span><span class="o">-</span><span class="n">H</span>    <span class="mf">123.410</span>      <span class="mf">7.967</span>   <span class="mf">2.25e+08</span>      <span class="mi">15517405</span>       <span class="mf">15.8</span>       <span class="mf">20.5</span>
   <span class="n">PHE12N</span><span class="o">-</span><span class="n">H</span>    <span class="mf">120.353</span>      <span class="mf">8.712</span>   <span class="mf">3.20e+08</span>      <span class="mi">44377264</span>        <span class="mf">9.3</span>       <span class="mf">16.6</span>
   <span class="n">etc</span><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="nmrpipe-peak-list">
<h2>NMRPipe peak list<a class="headerlink" href="#nmrpipe-peak-list" title="Permalink to this headline">¶</a></h2>
<p>Default peak list generated by NMRDraw (e.g. test.tab):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">VARS</span>   <span class="n">INDEX</span> <span class="n">X_AXIS</span> <span class="n">Y_AXIS</span> <span class="n">DX</span> <span class="n">DY</span> <span class="n">X_PPM</span> <span class="n">Y_PPM</span> <span class="n">X_HZ</span> <span class="n">Y_HZ</span> <span class="n">XW</span> <span class="n">YW</span> <span class="n">XW_HZ</span> <span class="n">YW_HZ</span> <span class="n">X1</span> <span class="n">X3</span> <span class="n">Y1</span> <span class="n">Y3</span> <span class="n">HEIGHT</span> <span class="n">DHEIGHT</span> <span class="n">VOL</span> <span class="n">PCHI2</span> <span class="n">TYPE</span> <span class="n">ASS</span> <span class="n">CLUSTID</span> <span class="n">MEMCNT</span>
<span class="n">FORMAT</span> <span class="o">%</span><span class="mi">5</span><span class="n">d</span> <span class="o">%</span><span class="mf">9.3</span><span class="n">f</span> <span class="o">%</span><span class="mf">9.3</span><span class="n">f</span> <span class="o">%</span><span class="mf">6.3</span><span class="n">f</span> <span class="o">%</span><span class="mf">6.3</span><span class="n">f</span> <span class="o">%</span><span class="mf">8.3</span><span class="n">f</span> <span class="o">%</span><span class="mf">8.3</span><span class="n">f</span> <span class="o">%</span><span class="mf">9.3</span><span class="n">f</span> <span class="o">%</span><span class="mf">9.3</span><span class="n">f</span> <span class="o">%</span><span class="mf">7.3</span><span class="n">f</span> <span class="o">%</span><span class="mf">7.3</span><span class="n">f</span> <span class="o">%</span><span class="mf">8.3</span><span class="n">f</span> <span class="o">%</span><span class="mf">8.3</span><span class="n">f</span> <span class="o">%</span><span class="mi">4</span><span class="n">d</span> <span class="o">%</span><span class="mi">4</span><span class="n">d</span> <span class="o">%</span><span class="mi">4</span><span class="n">d</span> <span class="o">%</span><span class="mi">4</span><span class="n">d</span> <span class="o">%+</span><span class="n">e</span> <span class="o">%+</span><span class="n">e</span> <span class="o">%+</span><span class="n">e</span> <span class="o">%.</span><span class="mi">5</span><span class="n">f</span> <span class="o">%</span><span class="n">d</span> <span class="o">%</span><span class="n">s</span> <span class="o">%</span><span class="mi">4</span><span class="n">d</span> <span class="o">%</span><span class="mi">4</span><span class="n">d</span>

<span class="n">NULLVALUE</span> <span class="o">-</span><span class="mi">666</span>
<span class="n">NULLSTRING</span> <span class="o">*</span>

    <span class="mi">1</span>   <span class="mf">159.453</span>    <span class="mf">10.230</span>  <span class="mf">0.006</span>  <span class="mf">0.004</span>    <span class="mf">9.336</span>  <span class="mf">129.673</span>  <span class="mf">7471.831</span> <span class="mf">10516.882</span>   <span class="mf">2.886</span>   <span class="mf">2.666</span>   <span class="mf">16.937</span>   <span class="mf">20.268</span>  <span class="mi">159</span>  <span class="mi">160</span>    <span class="mi">9</span>   <span class="mi">11</span> <span class="o">+</span><span class="mf">2.564241e+07</span> <span class="o">+</span><span class="mf">2.505288e+04</span> <span class="o">+</span><span class="mf">1.122633e+08</span> <span class="mf">0.00000</span> <span class="mi">1</span> <span class="kc">None</span>    <span class="mi">1</span>    <span class="mi">1</span>
    <span class="mi">2</span>    <span class="mf">17.020</span>    <span class="mf">13.935</span>  <span class="mf">0.002</span>  <span class="mf">0.002</span>   <span class="mf">10.381</span>  <span class="mf">129.326</span>  <span class="mf">8307.740</span> <span class="mf">10488.713</span>   <span class="mf">2.671</span>   <span class="mf">2.730</span>   <span class="mf">15.678</span>   <span class="mf">20.752</span>   <span class="mi">16</span>   <span class="mi">18</span>   <span class="mi">13</span>   <span class="mi">15</span> <span class="o">+</span><span class="mf">4.326169e+07</span> <span class="o">+</span><span class="mf">2.389882e+04</span> <span class="o">+</span><span class="mf">2.338556e+08</span> <span class="mf">0.00000</span> <span class="mi">1</span> <span class="kc">None</span>    <span class="mi">2</span>    <span class="mi">1</span>
    <span class="n">etc</span><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="nmrpipe-data">
<h2>NMRPipe Data<a class="headerlink" href="#nmrpipe-data" title="Permalink to this headline">¶</a></h2>
<p>The input data should be either an NMRPipe 2D or 3D cube. The dimension order can be specified with the <code class="docutils literal notranslate"><span class="pre">--dims</span></code> flag.
For example, if you have a 2D spectrum with shape (F1_size,F2_size) then you should call the scripts using <code class="docutils literal notranslate"><span class="pre">--dims=0,1</span></code>.
If you have a 3D cube with shape (F2_size,F1_size,ID) then you would run the scripts with <code class="docutils literal notranslate"><span class="pre">--dims=2,1,0</span></code> ([F2,ID,F1]
would be <code class="docutils literal notranslate"><span class="pre">--dims=1,2,0</span></code> i.e the indices required to reorder to 0,1,2).
The default dimension order is ID,F1,F2.</p>
</div>
<div class="section" id="peakipy-read">
<h2>peakipy read<a class="headerlink" href="#peakipy-read" title="Permalink to this headline">¶</a></h2>
<p>Here is an example of how to read a Sparky peaklist:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peakipy</span> <span class="n">read</span> <span class="n">peaks</span><span class="o">.</span><span class="n">sparky</span> <span class="n">test</span><span class="o">.</span><span class="n">ft2</span> <span class="o">--</span><span class="n">sparky</span> <span class="o">--</span><span class="n">show</span>
</pre></div>
</div>
<p>This will convert your peak list into a <code class="docutils literal notranslate"><span class="pre">pandas</span> <span class="pre">DataFrame</span></code> and use <code class="docutils literal notranslate"><span class="pre">threshold_otsu</span></code> from <code class="docutils literal notranslate"><span class="pre">scikit-image</span></code> to determine a cutoff for selecting overlapping peaks.
These are subsequently grouped into clusters (“CLUSTID” column a la NMRPipe!).
The new peak list with selected clusters is saved as a csv file <code class="docutils literal notranslate"><span class="pre">peaks.csv</span></code> to be used as input for either
<code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">edit</span></code> or <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">fit</span></code>.
It is possible to set the threshold value manually using the <code class="docutils literal notranslate"><span class="pre">--thres</span></code> option. However, it may be preferable to adjust this parameter using <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">edit</span></code>.</p>
<p>Clustered peaks are colour coded and singlet peaks are black (shown below).
If you want to edit this plot after running <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">read</span></code> then you can edit <code class="docutils literal notranslate"><span class="pre">show_clusters.yml</span></code> and re-plot using
<code class="docutils literal notranslate"><span class="pre">spec</span> <span class="pre">show_clusters.yml</span></code>. Below is an example of a clustered peak list.</p>
<img alt="../_images/clusters1.png" src="../_images/clusters1.png" />
<p>The threshold level can be adjusted with the <code class="docutils literal notranslate"><span class="pre">--thres</span></code> option like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peakipy</span> <span class="n">read</span> <span class="n">peaks</span><span class="o">.</span><span class="n">sparky</span> <span class="n">test</span><span class="o">.</span><span class="n">ft2</span> <span class="o">--</span><span class="n">sparky</span> <span class="o">--</span><span class="n">show</span> <span class="o">--</span><span class="n">thres</span><span class="o">=</span><span class="mf">1e6</span>
</pre></div>
</div>
<p>This will exclude signals below 1e6.</p>
<p>It is also possible to adjust the clustering behaviour by changing the structuring element used for binary closing.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peakipy</span> <span class="n">read</span> <span class="n">peaks</span><span class="o">.</span><span class="n">sparky</span> <span class="n">test</span><span class="o">.</span><span class="n">ft2</span> <span class="o">--</span><span class="n">dims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="o">--</span><span class="n">struc_el</span><span class="o">=</span><span class="n">disk</span> <span class="o">--</span><span class="n">struc_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="o">--</span><span class="n">show</span>
</pre></div>
</div>
<p>The above would use a disk shaped structuring element with a radius of 4 points (see the <a class="reference external" href="http://scikit-image.org/docs/dev/api/skimage.morphology.html">scikit-image.morphology</a> module for more information).</p>
<p>The radii used for masking the data to be fitted can be adjusted by setting the <code class="docutils literal notranslate"><span class="pre">--f2radius</span></code> and <code class="docutils literal notranslate"><span class="pre">--f1radius</span></code> flags like so (values given in ppm)…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peakipy</span> <span class="n">read</span> <span class="n">peaks</span><span class="o">.</span><span class="n">sparky</span> <span class="n">test</span><span class="o">.</span><span class="n">ft2</span> <span class="o">--</span><span class="n">dims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="o">--</span><span class="n">f1radius</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">--</span><span class="n">f2radius</span><span class="o">=</span><span class="mf">0.04</span>
</pre></div>
</div>
<p>Note: <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">read</span></code> will generate a <code class="docutils literal notranslate"><span class="pre">peakipy.config</span></code> which is subsequently read by <code class="docutils literal notranslate"><span class="pre">edit</span></code>, <code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">check</span></code> so that the <code class="docutils literal notranslate"><span class="pre">--dims</span></code> option is not required after running <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">read</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;--dims&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">2</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="peakipy-edit">
<h2>peakipy edit<a class="headerlink" href="#peakipy-edit" title="Permalink to this headline">¶</a></h2>
<p>If the automatic clustering is not satisfactory you can manually adjust clusters and fitting start parameters using <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">edit</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peakipy</span> <span class="n">edit</span> <span class="o">&lt;</span><span class="n">peaklist</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">nmrdata</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This command will start a <code class="docutils literal notranslate"><span class="pre">bokeh</span></code> server and cause a tab to open in your internet browser in which you can interactively edit peak fitting parameters.</p>
<img alt="../_images/bokeh.png" src="../_images/bokeh.png" />
<p>Use the table on the right to select the cluster(s) you are interested and double click to edit values in the table.
For example if you think peak1 should be fitted with peak2 but they have different clustids then you can simply change peak2’s clustid to match peak1’s.</p>
<p>Once a set of peaks is selected (or at least one peak within a cluster) you can manually adjust their starting
parameters for fitting (including the X and Y radii for the fitting mask, using the sliders).</p>
<p>The effect of changing these parameters can be visualised by clicking on the <code class="docutils literal notranslate"><span class="pre">Fit</span> <span class="pre">selected</span></code> button which will cause a <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> wireframe plot to popup. Note that you must close this <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> interactive window before continuing with parameter adjustments (I will try and add a 3D visualisation that works in the browser…).
You will need to have your interactive backend correctly configured by editing your matplotlibrc file. If you don’t know where that is then you can find it by importing matplotlib into your Python interpreter and typing <code class="docutils literal notranslate"><span class="pre">matplotlib.get_data_path()</span></code>. If you have trouble with opening interactive matplotlib my first suggestion is to check that you have a <code class="docutils literal notranslate"><span class="pre">matplotlibrc</span></code> file placed in your home directory <code class="docutils literal notranslate"><span class="pre">~/.matplotlib/matplotlibrc</span></code> with the backend option set to either <code class="docutils literal notranslate"><span class="pre">TkAgg</span></code> or <code class="docutils literal notranslate"><span class="pre">Agg</span></code>. These usually work…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span><span class="p">:</span> <span class="n">TkAgg</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span><span class="p">:</span> <span class="n">Agg</span>
</pre></div>
</div>
<p>or for Mac users</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span><span class="p">:</span> <span class="n">macosx</span>
</pre></div>
</div>
<p>for example.</p>
<p>To test other peak clustering settings you can adjust the contour level (akin to changing <code class="docutils literal notranslate"><span class="pre">--thres</span></code>) or adjust the dimensions of the structuring element used for binary closing.</p>
<img alt="../_images/fit.png" src="../_images/fit.png" />
<p>If you like the parameters you have chosen then you can save the peak list using the <code class="docutils literal notranslate"><span class="pre">save</span></code> button. If you want to return to your edited peak
list at a later stage then run <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">edit</span></code> with the edited peak list as your <code class="docutils literal notranslate"><span class="pre">&lt;peaklist&gt;</span></code> argument.</p>
<p>Clicking <code class="docutils literal notranslate"><span class="pre">Quit</span></code> closes the bokeh server.</p>
<p>Peaks can be added via the <code class="docutils literal notranslate"><span class="pre">tap</span></code> button on the right side of the spectrum. Once the tap button is activated then peaks are added to the spectrum by double clicking at the desired position.</p>
</div>
<div class="section" id="peakipy-fit">
<h2>peakipy fit<a class="headerlink" href="#peakipy-fit" title="Permalink to this headline">¶</a></h2>
<p>Once you are satisfied with your fitting parameters <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">fit</span></code> can be run using the peak list generated by <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">read</span></code> or <code class="docutils literal notranslate"><span class="pre">edit_peaks</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">edited_peaks.csv</span></code>).</p>
<p>For example…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peakipy</span> <span class="n">fit</span> <span class="n">edited_peaks</span><span class="o">.</span><span class="n">csv</span> <span class="n">test</span><span class="o">.</span><span class="n">ft2</span> <span class="n">fits</span><span class="o">.</span><span class="n">csv</span> <span class="o">--</span><span class="n">dims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="o">--</span><span class="n">lineshape</span><span class="o">=</span><span class="n">PV</span>
</pre></div>
</div>
<p>Fits that are likely to need checking are flagged in the <code class="docutils literal notranslate"><span class="pre">log.txt</span></code> file.</p>
<p>If you have a <code class="docutils literal notranslate"><span class="pre">vclist</span></code> style file containing your delay values then you can run
<code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">fit</span></code> with the <code class="docutils literal notranslate"><span class="pre">--vclist</span></code> flag.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peakipy</span> <span class="n">fit</span> <span class="n">edited_peaks</span><span class="o">.</span><span class="n">csv</span> <span class="n">test</span><span class="o">.</span><span class="n">ft2</span> <span class="n">fits</span><span class="o">.</span><span class="n">csv</span> <span class="o">--</span><span class="n">dims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="o">--</span><span class="n">lineshape</span><span class="o">=</span><span class="n">PV</span> <span class="o">--</span><span class="n">vclist</span><span class="o">=</span><span class="n">vclist</span>
</pre></div>
</div>
<p>This will result in an extra column being added to your <code class="docutils literal notranslate"><span class="pre">fits.csv</span></code> file called <code class="docutils literal notranslate"><span class="pre">vclist</span></code> containing the corresponding delay values.</p>
<div class="section" id="note-on-vclists-and-plane-ordering">
<h3>Note on vclists and plane ordering<a class="headerlink" href="#note-on-vclists-and-plane-ordering" title="Permalink to this headline">¶</a></h3>
<p>In recent versions of NMRPipe, the automatically generated <code class="docutils literal notranslate"><span class="pre">fid.com</span></code> file from the <code class="docutils literal notranslate"><span class="pre">bruker</span></code> graphical conversion interface includes code to  reorder the planes in your pseudo 3D NMR spectrum (i.e. <code class="docutils literal notranslate"><span class="pre">sortPlanes.com</span></code> is called with your tau list). If you run peakipy using this reordered data and your original vclist then your planes will be incorrectly ordered with respect to your <code class="docutils literal notranslate"><span class="pre">vclist</span></code>. This can be remedied in any of  the following ways:</p>
<ol class="arabic simple">
<li><p>Reorder your vclist to reflect the actual order of your planes after running the <code class="docutils literal notranslate"><span class="pre">bruker</span></code> conversion script.</p></li>
<li><p>Include the <code class="docutils literal notranslate"><span class="pre">--sorted</span></code> flag when running <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">fit</span></code> in order to sort the input <code class="docutils literal notranslate"><span class="pre">vclist</span></code> on the fly.</p></li>
<li><p>Remove the call to <code class="docutils literal notranslate"><span class="pre">sortPlanes.com</span></code> from your <code class="docutils literal notranslate"><span class="pre">fid.com</span></code> conversion script and then call <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">fit</span></code> as shown above with your original <code class="docutils literal notranslate"><span class="pre">vclist</span></code></p></li>
</ol>
<p>Below is an example of how you would run <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">fit</span></code> if you have pre-sorted  your data</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peakipy</span> <span class="n">fit</span> <span class="n">edited_peaks</span><span class="o">.</span><span class="n">csv</span> <span class="n">test</span><span class="o">.</span><span class="n">ft2</span> <span class="n">fits</span><span class="o">.</span><span class="n">csv</span> <span class="o">--</span><span class="n">dims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="o">--</span><span class="n">lineshape</span><span class="o">=</span><span class="n">PV</span> <span class="o">--</span><span class="n">vclist</span><span class="o">=</span><span class="n">vclist</span> <span class="o">--</span><span class="nb">sorted</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="checking-fits">
<h2>Checking fits<a class="headerlink" href="#checking-fits" title="Permalink to this headline">¶</a></h2>
<p>To plot fits for all planes or interactively check them you can run <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">check</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peakipy</span> <span class="n">check</span> <span class="n">fits</span><span class="o">.</span><span class="n">csv</span> <span class="n">test</span><span class="o">.</span><span class="n">ft2</span> <span class="o">--</span><span class="n">dims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="o">--</span><span class="n">clusters</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span> <span class="o">--</span><span class="n">show</span> <span class="o">--</span><span class="n">outname</span><span class="o">=</span><span class="n">plot</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>Will plot clusters 1,10 and 20 showing each plane in an interactive matplotlib window and save the plots to a multipage pdf called plot.pdf. Calling <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">check</span></code> with the <code class="docutils literal notranslate"><span class="pre">--first</span></code> flag results in only the first plane of each fit being plotted. The colour or output plots can be changed using the <code class="docutils literal notranslate"><span class="pre">--colors</span></code> like so</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peakipy</span> <span class="n">check</span> <span class="n">fits</span><span class="o">.</span><span class="n">csv</span> <span class="n">test</span><span class="o">.</span><span class="n">ft2</span> <span class="o">--</span><span class="n">dims</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span> <span class="o">--</span><span class="n">clusters</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span> <span class="o">--</span><span class="n">show</span> <span class="o">--</span><span class="n">outname</span><span class="o">=</span><span class="n">plot</span><span class="o">.</span><span class="n">pdf</span> <span class="o">--</span><span class="n">colors</span><span class="o">=</span><span class="n">green</span><span class="p">,</span><span class="n">purple</span>
</pre></div>
</div>
<p>Only valid matplotlib color names can be used.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">check</span> <span class="pre">-h</span></code> for more options.</p>
</div>
<div class="section" id="excluding-peaks">
<h2>Excluding peaks<a class="headerlink" href="#excluding-peaks" title="Permalink to this headline">¶</a></h2>
<p>Peaks can be excluded from fitting by changing the value in the <code class="docutils literal notranslate"><span class="pre">include</span></code> column from <code class="docutils literal notranslate"><span class="pre">yes</span></code> to <code class="docutils literal notranslate"><span class="pre">no</span></code> (in the <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file containing your peak list). The easiest way to do this is via the <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">edit</span></code> script.</p>
</div>
<div class="section" id="protocol">
<h2>Protocol<a class="headerlink" href="#protocol" title="Permalink to this headline">¶</a></h2>
<p>Initial parameters for FWHM, peak centers and fraction are fitted from the sum of all planes in your spectrum (for best signal to noise). Following this, the default method is to fix center, linewidth and fraction parameters only fitting the amplitudes for each plane. If you want to float all parameters, this can be done with <code class="docutils literal notranslate"><span class="pre">--fix=None</span></code> or you could just float the linewidths and amplitudes with <code class="docutils literal notranslate"><span class="pre">--fix=fraction,center</span></code>.</p>
</div>
<div class="section" id="outputs">
<h2>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Pandas DataFrame containing fitted intensities/linewidths/centers etc:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">,</span><span class="n">fit_prefix</span><span class="p">,</span><span class="n">assignment</span><span class="p">,</span><span class="n">amp</span><span class="p">,</span><span class="n">amp_err</span><span class="p">,</span><span class="n">center_x</span><span class="p">,</span><span class="n">center_y</span><span class="p">,</span><span class="n">sigma_x</span><span class="p">,</span><span class="n">sigma_y</span><span class="p">,</span><span class="n">fraction</span><span class="p">,</span><span class="n">clustid</span><span class="p">,</span><span class="n">plane</span><span class="p">,</span><span class="n">x_radius</span><span class="p">,</span><span class="n">y_radius</span><span class="p">,</span><span class="n">x_radius_ppm</span><span class="p">,</span><span class="n">y_radius_ppm</span><span class="p">,</span><span class="n">lineshape</span><span class="p">,</span><span class="n">fwhm_x</span><span class="p">,</span><span class="n">fwhm_y</span><span class="p">,</span><span class="n">center_x_ppm</span><span class="p">,</span><span class="n">center_y_ppm</span><span class="p">,</span><span class="n">sigma_x_ppm</span><span class="p">,</span><span class="n">sigma_y_ppm</span><span class="p">,</span><span class="n">fwhm_x_ppm</span><span class="p">,</span><span class="n">fwhm_y_ppm</span><span class="p">,</span><span class="n">fwhm_x_hz</span><span class="p">,</span><span class="n">fwhm_y_hz</span>
<span class="mi">0</span><span class="p">,</span><span class="n">_None_</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="mf">291803398.52980924</span><span class="p">,</span><span class="mf">5502183.185104156</span><span class="p">,</span><span class="mf">158.44747896487527</span><span class="p">,</span><span class="mf">9.264911100915297</span><span class="p">,</span><span class="mf">1.1610674220702277</span><span class="p">,</span><span class="mf">1.160506074898704</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">4.773</span><span class="p">,</span><span class="mf">3.734</span><span class="p">,</span><span class="mf">0.035</span><span class="p">,</span><span class="mf">0.35</span><span class="p">,</span><span class="n">G</span><span class="p">,</span><span class="mf">2.3221348441404555</span><span class="p">,</span><span class="mf">2.321012149797408</span><span class="p">,</span><span class="mf">9.336283145411077</span><span class="p">,</span><span class="mf">129.6698850201278</span><span class="p">,</span><span class="mf">0.008514304888101518</span><span class="p">,</span><span class="mf">0.10878688239041588</span><span class="p">,</span><span class="mf">0.017028609776203036</span><span class="p">,</span><span class="mf">0.21757376478083176</span><span class="p">,</span><span class="mf">13.628064792721176</span><span class="p">,</span><span class="mf">17.645884354478063</span>
<span class="mi">1</span><span class="p">,</span><span class="n">_None_</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="mf">197443035.67109975</span><span class="p">,</span><span class="mf">3671708.463467884</span><span class="p">,</span><span class="mf">158.44747896487527</span><span class="p">,</span><span class="mf">9.264911100915297</span><span class="p">,</span><span class="mf">1.1610674220702277</span><span class="p">,</span><span class="mf">1.160506074898704</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">4.773</span><span class="p">,</span><span class="mf">3.734</span><span class="p">,</span><span class="mf">0.035</span><span class="p">,</span><span class="mf">0.35</span><span class="p">,</span><span class="n">G</span><span class="p">,</span><span class="mf">2.3221348441404555</span><span class="p">,</span><span class="mf">2.321012149797408</span><span class="p">,</span><span class="mf">9.336283145411077</span><span class="p">,</span><span class="mf">129.6698850201278</span><span class="p">,</span><span class="mf">0.008514304888101518</span><span class="p">,</span><span class="mf">0.10878688239041588</span><span class="p">,</span><span class="mf">0.017028609776203036</span><span class="p">,</span><span class="mf">0.21757376478083176</span><span class="p">,</span><span class="mf">13.628064792721176</span><span class="p">,</span><span class="mf">17.645884354478063</span>
<span class="n">etc</span><span class="o">...</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">log.txt</span></code> contains fit reports for all fits</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">--plot=&lt;path&gt;</span></code> option selected when running <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">fit</span></code>, the first plane of each fit will be plotted in &lt;path&gt; with the files named according to the cluster ID (clustid) of the fit. Adding <code class="docutils literal notranslate"><span class="pre">--show</span></code> option calls <code class="docutils literal notranslate"><span class="pre">plt.show()</span></code> on each fit so you can see what it looks like. However, using <code class="docutils literal notranslate"><span class="pre">peakipy</span> <span class="pre">check</span></code> should be preferable since plotting the fits during fitting slows down the process a lot.</p></li>
</ol>
<p>You can explore the output data conveniently with <code class="docutils literal notranslate"><span class="pre">pandas</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;fits.csv&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;assignment&quot;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">vclist</span><span class="p">,</span><span class="n">group</span><span class="o">.</span><span class="n">amp</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">amp_err</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">group</span><span class="o">.</span><span class="n">assignment</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
   <span class="o">...</span><span class="p">:</span>     <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=j-brady&repo=peakipy&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">How to install peakipy</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart instructions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Instructions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#analysis2-peak-list">Analysis2 peak list</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sparky-peak-list">Sparky peak list</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nmrpipe-peak-list">NMRPipe peak list</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nmrpipe-data">NMRPipe Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#peakipy-read">peakipy read</a></li>
<li class="toctree-l2"><a class="reference internal" href="#peakipy-edit">peakipy edit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#peakipy-fit">peakipy fit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#checking-fits">Checking fits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#excluding-peaks">Excluding peaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#protocol">Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="#outputs">Outputs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="lineshapes.html">Lineshapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="code.html">Code</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="quickstart.html" title="previous chapter">Quickstart instructions</a></li>
      <li>Next: <a href="examples.html" title="next chapter">Examples</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Jacob Peter Brady.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/usage/instructions.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>